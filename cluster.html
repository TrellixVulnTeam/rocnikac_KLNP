<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<title>Display a map</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.css' rel='stylesheet' />
	<style>
		body { margin:0; padding:0; }
		#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>
</head>
<style>
	.marker {
		display: block;
		border: none;
		border-radius: 50%;
		cursor: pointer;
		padding: 0;
	}
</style>
<body>
<div id='map'></div>
<script>
	function drawShape(geojson) {
		map.addLayer({
			"id": lineStringLayerID,
			"type": "line",
			"source": {
				"type": "geojson",
				"data": geojson
			},
			"layout": {
				"line-join": "round",
				"line-cap": "round"
			},
			"paint": {
				"line-color": "#BF93E4",
				"line-width": 5
			}
		});
	}
	mapboxgl.accessToken = 'pk.eyJ1IjoiZmlsaXBjaXptYXIiLCJhIjoiY2sxaHp3eHlzMGlmODNkanl2c2tqdTZscSJ9.rujrBlG1rSLuHpFaxxYX9w';

	var map = new mapboxgl.Map({
		container: 'map', // container id
		style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
		center: [14.6, 50.1], // starting position [lng, lat]
		zoom: 10 // starting zoom
	});

	map.on('load', function() {

		map.addSource("buses", {
			type: "geojson",
			data: "last_positions",
			cluster: true,
			clusterMaxZoom: 14, // Max zoom to cluster points on
			clusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)
		});

		map.addLayer({
			id: "clusters",
			type: "circle",
			source: "buses",
			filter: ["has", "point_count"],
			paint: {
				"circle-color": [
					"step",
					["get", "point_count"],
					"#51bbd6",
					10,
					"#f1f075",
					50,
					"#f28cb1"
				],
				"circle-radius": [
					"step",
					["get", "point_count"],
					20,
					100,
					30,
					750,
					40
				]
			}
		});

		map.addLayer({
			id: "cluster-count",
			type: "symbol",
			source: "buses",
			filter: ["has", "point_count"],
			layout: {
				"text-field": "{point_count_abbreviated}",
				"text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
				"text-size": 12
			}
		});

		map.addLayer({
			id: "unclustered-point",
			type: "symbol",
			source: "buses",
			layout: {
				"text-field": ["number-format", ["get", "message"], {}],
				"text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
				"text-size": 10
			}
		});
	});




	lineStringLayerID = "";

</script>

</body>
</html>
